!function(t){t(window).on("elementor/frontend/init",(function(){elementorFrontend.hooks.addAction("frontend/element_ready/the7-woocommerce-product-add-to-cart-v2.default",(function(t,e){e((function(){t.productVariations()}))}))})),t.productVariations=function(i){const n=t(i),s=n.find(".the7-vr-options"),a=n.find("[data-product_variations]"),r=n.find("form"),o=r.find(".single_variation");let c,d;t.data(i,"productVariations",n);const f={init:function(){if(s.length){const i=new e({variations:a.data("product_variations"),state:a.data("default_attributes")||{},render:function(){const e=this.getState();if(!e)return;const i=Object.keys(e).filter((function(t){return!!t})).map((function(i){return"a."+t.escapeSelector(i+"_"+e[i])})).join(","),n=s.find("li");n.removeClass("active"),n.find(i).each((function(){t(this).parent().addClass("active")})),r.find(".variations select").each((function(){const i=t(this),n=i.attr("name");void 0!==e[n]&&e[n]!==i.val()&&i.val(e[n]).trigger("change")})),f.handleOutOfStockVisibility(this.findMatchingOutOfStockVariations4())}});t("li a",s).on("click",(function(e){e.preventDefault();const n=t(this),s=n.parent(),a={["attribute_"+t.escapeSelector(n.closest("ul").attr("data-atr"))]:s.hasClass("active")?"":String(n.data("id"))};i.updateState(a);const r=Object.entries(i.getState()).reduce(((t,[e,i])=>(i&&(t[e]=i),t)),{});f.updateProductImage(i.getVariationImage(r))})),r.find(".variations select").each((function(){const e=t(this),i=e.val();if(i.length){const n=t.escapeSelector(e.attr("id"));s.filter("[data-atr='"+n+"']").find("li a[data-id='"+i+"']").trigger("click")}}))}const i=function(){o.children().not(":empty").last().addClass("last")};n.find(".single_variation_wrap").on("show_variation",(function(t,e){i()})),i()},getProductSlider:function(){if("undefined"==typeof sliderObject){const t=n.closest(".product").find(".elementor-widget-the7-woocommerce-product-images-slider");t.length?sliderObject=t.data("the7Slider").getSwiper():sliderObject=null}return sliderObject},replaceImage:function(e,i){d||(d=e.first().clone()),n.addClass("replace-is-loading"),c=t(),e.each((function(){t(this).replaceWith((function(){const t=i.clone();return t.on("load",(function(){n.removeClass("replace-is-loading")})),c=c.add(t),t}))})),n.addClass("has-replaced-img"),n.closest(".product").find(".elementor-widget-the7-woocommerce-product-images-slider").layzrInitialisation()},restoreImage:function(){c&&c.length&&d&&d.length&&(f.replaceImage(c,d),c=void 0,n.removeClass("has-replaced-img"))},updateProductImage:function(e){if(!e||!e.length)return void f.restoreImage();const i=f.getProductSlider();if(i){const n=t(i.wrapperEl).find('img[src="'+e.attr("data-src")+'"]').first();if(n.length)f.restoreImage(),i.slideTo(i.slides.indexOf(n.closest(".the7-swiper-slide")[0]));else{i.slideTo(0);const n=1===i.slides.length?t(i.slides[0]).find("img"):t(i.$wrapperEl).find('.the7-swiper-slide[data-swiper-slide-index="0"]').find("img");f.replaceImage(n,e)}}},handleOutOfStockVisibility(t){const e=t,i=s.find("li a");i.removeClass("out-of-stock");for(const[t,n]of Object.entries(e))if(n.length){const t=n.slice().map((t=>"[data-id="+t+"]")).join(",");i.filter(t).addClass("out-of-stock")}}};f.init()},t.fn.productVariations=function(){return this.each((function(){void 0!==t(this).data("productVariations")&&t(this).removeData("productVariations"),new t.productVariations(this)}))};class e{constructor(t){this.data=t||{},this.data.outOfStockAttributes=this.findOutOfStockAttributes(),this.data.state=this.data.state||{}}getState(t){return t?this.data.state[t]:Object.assign({},this.data.state)}updateState(t){this.data.state=Object.assign({},this.data.state,t),"function"==typeof this.data.render&&this.data.render.call(this)}findMatchingVariation(){const t=this.data.variations,e=this.getState();for(var i=[],n=0;n<t.length;n++){var s=t[n];this.isExactMatch(s.attributes,e)&&i.push(s)}return i.shift()}getVariationImage(e){const i=this.findFirstMatchingVariationOfGivenState(e);if(!i)return;const n=i.image;return t(`\n                    <img\n                        class="replaced-img preload-me aspect lazy lazy-load"\n                        style="--ratio: ${n.src_w} / ${n.src_h};"\n                        width="${n.src_w}"\n                        height="${n.src_h}"\n                        data-src="${n.src}"\n                        data-srcset="${n.srcset||""}"\n                        alt="${n.alt||""}"\n                        title="${n.title||""}"\n                        data-caption="${n.data_caption||""}"\n                        loading="eager"\n                        data-large_image="${n.full_src}"\n                        data-large_image_width="${n.full_src_w}"\n                        data-large_image_height="${n.full_src_h}"\n                        sizes="${n.sizes}"\n                    />\n                `)}findAttributesWithOutOfStockVariationsInAttributeMap(t,e){if("function"==typeof e&&"object"==typeof t)for(const[i,n]of Object.entries(t)){const[t,s]=i.split("///");n.every((function(t){return!t.is_in_stock}))&&e(t,s,n)}}getAttributesCombination(){const t=Object.entries(this.getState()).reduce((function(t,[e,i]){return i&&(t[e]=i),t}),{}),e=Object.keys(t),i=Object.values(t),n=[];if(e.length>1)for(let s=0;s<e.length;s++){const a=e[s];if(i[s]){const e=Object.assign({},t);e[a]="",n.push(e)}}return n}getMatchingIntersectionAttributes(t,e,i){const n=e.filter((function(e){return Object.entries(e.attributes).every((function([e,i]){return!t[e]||!i||t[e]===i}))})),s={};for(const[e,a]of Object.entries(i)){const[i,r]=e.split("///");t[i]!==r&&a.forEach((function(t){-1!==n.indexOf(t)&&(s[e]=s[e]||[],-1===s[e].indexOf(t)&&s[e].push(t))}))}return s}findMatchingOutOfStockVariations4(){const t=this,e=this.data.variations,i=this.getState(),n=Object.keys(i).filter((function(t){return i[t]})).length,s=[],a={},r={},o={},c={};e.forEach((function(e){const n=t.isMatch(e.attributes,i);n&&s.push(e);for(const[t,i]of Object.entries(e.attributes)){const s=t+"///"+i;o[s]=o[s]||[],-1===o[s].indexOf(e)&&o[s].push(e),e.is_in_stock&&(c[s]=c[s]||[],-1===c[s].indexOf(e)&&c[s].push(e)),n&&(a[s]=a[s]||[],-1===a[s].indexOf(e)&&a[s].push(e),e.is_in_stock&&(r[s]=r[s]||[],-1===r[s].indexOf(e)&&r[s].push(e)))}}));const d={},f=this.getAttributesCombination();if(f.length)f.forEach((function(e){const n=t.getMatchingIntersectionAttributes(e,s,r);for(const[t,e]of Object.entries(n)){const[e,n]=t.split("///");i[e]&&(d[e]=d[e]||[],d[e].push(n))}}));else for(const[t,e]of Object.entries(c)){const[e,s]=t.split("///");(i[e]||0===n)&&(d[e]=d[e]||[],d[e].push(s))}const l=t.getMatchingIntersectionAttributes(i,s,r);for(const[t,e]of Object.entries(l)){const[e,i]=t.split("///");d[e]=d[e]||[],d[e].push(i)}for(const[t,e]of Object.entries(d))d[t]=[...new Set(e)];const u={};for(const[t,e]of Object.entries(o)){const[e,i]=t.split("///");!i||d[e]&&-1!==d[e].indexOf(i)||(u[e]=u[e]||[],u[e].push(i))}return u}findOutOfStockAttributes(){const t=this.data.variations;let e=[],i=[],n={};for(let n=0;n<t.length;n++){let s=t[n];s.is_in_stock?e.push(Object.entries(s.attributes)):i.push(Object.entries(s.attributes))}e=[].concat(...e),i=[].concat(...i);const s=function(t,e){const i=e[0],n=e[1];return t[i]=t[i]||[],t[i].push(n),t},a=e.reduce(s,{}),r=i.reduce(s,{});for(const[t,e]of Object.entries(r)){const i=void 0===a[t];(i||a[t])&&(n[t]=e.filter((function(e){return i||!a[t].includes(e)})))}return n}findFirstMatchingVariationOfGivenState(t){if(!t||0===Object.keys(t).length)return;const e=this.data.variations;for(let i=0;i<e.length;i++){let n=e[i];if(this.isExactMatch(t,n.attributes))return n}}isMatch(t,e){var i=!1;for(var n in t)if(t.hasOwnProperty(n)){var s=t[n],a=e[n];void 0!==s&&0===s.length&&(s=a),void 0!==s&&void 0!==a&&0!==s.length&&0!==a.length&&s===a&&(i=!0)}return i}isExactMatch(t,e){for(var i in t)if(t.hasOwnProperty(i)){var n=t[i],s=e[i];if(void 0===n||void 0===s||0===s.length||0!==n.length&&n!==s)return!1}return!0}}}(jQuery);